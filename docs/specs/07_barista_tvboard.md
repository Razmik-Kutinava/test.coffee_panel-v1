# 07. Табло баристы и TV-борд

> Интерфейсы для операционной работы на точке

---

## 1. Табло баристы

### 1.1 Описание

Интерфейс для баристы в Telegram — простой список заказов с кнопками смены статусов. Реализуется как Telegram Bot с inline-кнопками в группе точки.

### 1.2 Новый заказ (уведомление)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          TELEGRAM GROUP: Тверская                           │
└─────────────────────────────────────────────────────────────────────────────┘

🔔 НОВЫЙ ЗАКАЗ #42

👤 Александр
📍 Тверская

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

☕ Капучино L
   • Овсяное молоко
   • Ванильный сироп
   💬 Без сахара

🥐 Круассан × 2

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💰 711 ₽
🕐 14:32

┌─────────────────────┐  ┌─────────────────────┐
│    ✅ Принять       │  │    ❌ Отменить      │
└─────────────────────┘  └─────────────────────┘
```

### 1.3 Заказ принят (обновление сообщения)

```
📋 ЗАКАЗ #42 — В РАБОТЕ

👤 Александр

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

☕ Капучино L
   • Овсяное молоко
   • Ванильный сироп
   💬 Без сахара

🥐 Круассан × 2

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🕐 В работе: 2 мин

┌─────────────────────┐  ┌─────────────────────┐
│    ☕ Готово        │  │    ⚠️ Проблема      │
└─────────────────────┘  └─────────────────────┘
```

### 1.4 Заказ готов

```
✅ ЗАКАЗ #42 — ГОТОВ

👤 Александр

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Ожидает выдачи

🕐 Готов: 1 мин

┌─────────────────────┐
│    📦 Выдано        │
└─────────────────────┘
```

### 1.5 Заказ выдан (финальное состояние)

```
✅ ЗАКАЗ #42 — ВЫДАН

👤 Александр
💰 711 ₽

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

⏱ Время выполнения: 8 мин

Выдал: Анна В.
```

### 1.6 Отмена заказа

```
❌ ЗАКАЗ #42 — ОТМЕНЁН

👤 Александр
💰 711 ₽ (возврат)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Причина: Нет ингредиентов

Отменил: Анна В.
```

---

## 2. Управление остатками

### 2.1 Команда /stock

```
📦 ОСТАТКИ ТОЧКИ

Тверская ул., 15
Обновлено: 14:35

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

КОФЕ
☕ Капучино.............. 45
☕ Латте................. 38
☕ Американо............. 52

ВЫПЕЧКА
🥐 Круассан.............. 3  ⚠️
🥯 Булочка с корицей..... 8
🧁 Маффин................ 12

ЕДА
🥪 Сэндвич............... 0  🚫
🥗 Салат................. 5

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

⚠️ = мало на складе
🚫 = "Раскупили" в приложении

[Обновить остатки]
```

### 2.2 Редактирование остатков

```
📦 РЕДАКТИРОВАНИЕ ОСТАТКОВ

Выберите товар:

┌─────────────────────┐
│ ☕ Капучино    45   │
└─────────────────────┘
┌─────────────────────┐
│ ☕ Латте       38   │
└─────────────────────┘
┌─────────────────────┐
│ 🥐 Круассан    3 ⚠️ │
└─────────────────────┘
┌─────────────────────┐
│ 🥪 Сэндвич     0 🚫 │
└─────────────────────┘

[Назад]
```

### 2.3 Изменение количества

```
📦 КРУАССАН

Текущий остаток: 3

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

┌───────┐  ┌───────┐  ┌───────┐
│  −5   │  │  −1   │  │  +1   │
└───────┘  └───────┘  └───────┘

┌───────┐  ┌───────┐  ┌───────┐
│  +5   │  │  +10  │  │Ввести │
└───────┘  └───────┘  └───────┘

[Назад]
```

---

## 3. Команды бота для баристы

| Команда | Описание | Доступ |
|---------|----------|--------|
| `/orders` | Список активных заказов | Бариста+ |
| `/stock` | Управление остатками | Бариста+ |
| `/stats` | Статистика за день | Бариста+ |
| `/help` | Справка по командам | Все |

### 3.1 Статистика за день (/stats)

```
📊 СТАТИСТИКА ЗА СЕГОДНЯ

Тверская ул., 15
15 января 2024

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📦 Заказов: 47
💰 Выручка: 21,500 ₽
📈 Средний чек: 457 ₽

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

ПО СТАТУСАМ
✅ Выдано: 42
🟡 В работе: 3
🔵 Ожидает: 2
❌ Отменено: 0

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

ТОП-3 ТОВАРА
1. Капучино — 23 шт
2. Латте — 15 шт
3. Круассан — 12 шт
```

---

## 4. TV-борд

### 4.1 Описание

Веб-страница для отображения на экране в кофейне. Обновляется в реальном времени через WebSocket.

### 4.2 URL

Каждая точка имеет свой поддомен:
- `msk-tverskaya.board.brand.ru`
- `msk-arbat.board.brand.ru`
- `spb-nevsky.board.brand.ru`

### 4.3 Интерфейс TV-борда

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│                          ☕ КОФЕЙНЯ ТВЕРСКАЯ                                │
│                                                                             │
│  ═══════════════════════════════════════════════════════════════════════   │
│                                                                             │
│                            ⏳ ГОТОВИТСЯ                                     │
│                                                                             │
│       ┌─────────────┐   ┌─────────────┐   ┌─────────────┐                  │
│       │             │   │             │   │             │                  │
│       │     #42     │   │     #43     │   │     #44     │                  │
│       │  Александр  │   │    Мария    │   │   Дмитрий   │                  │
│       │             │   │             │   │             │                  │
│       └─────────────┘   └─────────────┘   └─────────────┘                  │
│                                                                             │
│  ═══════════════════════════════════════════════════════════════════════   │
│                                                                             │
│                          ✅ ГОТОВО! ЗАБЕРИТЕ                                │
│                                                                             │
│                        ┌─────────────────────┐                              │
│                        │                     │                              │
│                        │        #41          │                              │
│                        │       Елена         │  ← Пульсирует                │
│                        │                     │                              │
│                        └─────────────────────┘                              │
│                                                                             │
│  ═══════════════════════════════════════════════════════════════════════   │
│                                                                             │
│                               BRAND ☕                                       │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.4 Состояния заказа на борде

| Состояние | Отображение | Поведение |
|-----------|-------------|-----------|
| `accepted` | Секция "Готовится" | Появляется |
| `preparing` | Секция "Готовится" | Без изменений |
| `ready` | Секция "Готово" | Перемещается + звук + пульсация |
| `completed` | — | Исчезает |

### 4.5 WebSocket события

```typescript
// Подключение
const ws = new WebSocket('wss://api.brand.ru/ws/tv-board/msk-tverskaya');

// Входящие события
interface WSMessage {
  type: 'orders_update' | 'order_ready' | 'order_completed';
  data: any;
}

// orders_update — полное обновление списка
{
  type: 'orders_update',
  data: {
    preparing: [
      { order_number: 42, customer_name: 'Александр' },
      { order_number: 43, customer_name: 'Мария' },
      { order_number: 44, customer_name: 'Дмитрий' }
    ],
    ready: [
      { order_number: 41, customer_name: 'Елена' }
    ]
  }
}

// order_ready — заказ готов
{
  type: 'order_ready',
  data: {
    order_number: 42,
    customer_name: 'Александр'
  }
}

// order_completed — заказ выдан
{
  type: 'order_completed',
  data: {
    order_number: 42
  }
}
```

### 4.6 Темизация

```typescript
interface TVBoardTheme {
  background_color: string;   // Фон: #1a1a1a
  text_color: string;         // Текст: #ffffff
  accent_color: string;       // Акцент (готово): #00ff00
  preparing_color: string;    // Готовится: #ffa500
  logo_url?: string;          // Логотип
}
```

### 4.7 Режим "Нет заказов"

Когда нет активных заказов, показывается:
- Логотип и название кофейни
- Слайдшоу промо-материалов (если настроено)
- Или статичная заставка

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│                                                                             │
│                                                                             │
│                                                                             │
│                              ☕                                              │
│                                                                             │
│                          BRAND COFFEE                                       │
│                                                                             │
│                     Закажи кофе в Telegram                                  │
│                        @brand_coffee_bot                                    │
│                                                                             │
│                                                                             │
│                                                                             │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. Поток данных: Заказ → Бариста → TV-борд

```
                                                                    TV-БОРД
КЛИЕНТ              API                 БАРИСТА                     (WebSocket)
   │                 │                     │                            │
   │  Оплата         │                     │                            │
   │────────────────▶│                     │                            │
   │                 │                     │                            │
   │                 │  Push: Новый заказ  │                            │
   │                 │────────────────────▶│                            │
   │                 │                     │                            │
   │                 │  Кнопка: Принять    │                            │
   │                 │◀────────────────────│                            │
   │                 │                     │                            │
   │                 │                     │  WS: orders_update         │
   │                 │                     │  (добавить в "Готовится")  │
   │                 │─────────────────────────────────────────────────▶│
   │  Push: Принят   │                     │                            │
   │◀────────────────│                     │                            │
   │                 │                     │                            │
   │                 │  Кнопка: Готово     │                            │
   │                 │◀────────────────────│                            │
   │                 │                     │                            │
   │                 │                     │  WS: order_ready           │
   │                 │                     │  (переместить в "Готово")  │
   │                 │─────────────────────────────────────────────────▶│
   │  Push: Готов!   │                     │                            │
   │◀────────────────│                     │                            │
   │                 │                     │                            │
   │                 │  Кнопка: Выдано     │                            │
   │                 │◀────────────────────│                            │
   │                 │                     │                            │
   │                 │                     │  WS: order_completed       │
   │                 │                     │  (убрать с экрана)         │
   │                 │─────────────────────────────────────────────────▶│
   │  Push: Спасибо  │                     │                            │
   │◀────────────────│                     │                            │
```

---

## 6. Технические требования

### 6.1 Табло баристы (Telegram Bot)

- **Звуковые уведомления** при новом заказе
- **Inline-кнопки** для смены статуса
- **Обновление сообщения** при смене статуса (не новое сообщение)
- **Группировка** заказов в одну группу для точки
- **Конкурентный доступ** — защита от двойного принятия

### 6.2 TV-борд

- **WebSocket** для realtime обновлений
- **Автопереподключение** при потере соединения
- **Адаптивный дизайн** для разных размеров экранов
- **Звуковой сигнал** при готовности заказа
- **Анимация** перемещения заказа в "Готово"
- **Темная тема** по умолчанию (для лучшей читаемости)
- **Полноэкранный режим** (F11 / автозапуск)
